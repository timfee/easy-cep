# Ralph Orchestrator Configuration
# Generated by: ralph init --backend opencode
# Docs: https://github.com/mikeyobrien/ralph-orchestrator

cli:
  backend: "opencode"

event_loop:
  prompt_file: "PROMPT.md"
  completion_promise: "LOOP_COMPLETE"
  max_iterations: 100
  max_runtime_seconds: 14400
  checkpoint_interval: 5

# ─────────────────────────────────────────────────────────────────────────────
# Additional Configuration (uncomment to customize)
# ─────────────────────────────────────────────────────────────────────────────

# core:
#   scratchpad: ".agent/scratchpad.md"
#   specs_dir: "./specs/"

# Custom hats for multi-agent workflows:
# hats:
#   builder:
#     name: "Builder"
#     triggers: ["build.task"]
#     publishes: ["build.done", "build.blocked"]
#
#   reviewer:
#     name: "Reviewer"
#     triggers: ["review.request"]
#     publishes: ["review.approved", "review.changes_requested"]

# Create PROMPT.md with your task, then run: ralph run

hats:
  builder:
    name: "Builder"
    description: "Implements one task with backpressure. One task, one commit."
    triggers: ["build.task"]
    publishes: ["build.done", "build.blocked"]
    default_publishes: "build.done"
    instructions: |
      ## BUILDER MODE

      You're building, not planning. One task, then exit.

      ### Process
      1. **Pick ONE task.** Highest priority `[ ]` from scratchpad.
      2. **Implement.** Write the code. Follow existing patterns.
      3. **Validate.** Run backpressure. Must pass.
      4. **Commit.** One task, one commit.
      5. **Exit.** Publish `<event topic="build.done">` with evidence.

      ### Event Format
      Write events as JSONL:
      ```
      <event topic="build.done">
      tests: pass
      lint: pass
      typecheck: pass
      </event>
      ```

      ### Backpressure
      ```bash
      cargo check && cargo test && cargo clippy -- -D warnings
      ```

      ### DON'T
      - ❌ Create the scratchpad
      - ❌ Decide what tasks to add
      - ❌ Output the completion promise
      - ❌ Skip tests

      ### STUCK?
      Publish `<event topic="build.blocked">` with what you tried and why it failed.
core:
  scratchpad: ".agent/scratchpad.md"
  specs_dir: "./specs/"

  reviewer:
    name: "Reviewer"
    description: "Reviews implementation for quality. Does NOT modify code."
    triggers: ["review.request"]
    publishes: ["review.approved", "review.changes_requested"]
    default_publishes: "review.approved"
    instructions: |
      ## REVIEWER MODE

      Review the most recent implementation for quality.

      ### Checklist
      - [ ] **Correctness:** Does it match the spec/task requirements?
      - [ ] **Tests:** Are there tests? Do they cover edge cases?
      - [ ] **Patterns:** Does it follow existing codebase patterns?
      - [ ] **Errors:** Is error handling appropriate?
      - [ ] **Security:** Any obvious vulnerabilities?

      ### If Approved
      Publish `<event topic="review.approved">` — Ralph will coordinate next steps.

      ### If Changes Needed
      Publish `<event topic="review.changes_requested">` with specific feedback:
      ```
      <event topic="review.changes_requested">
      ## Issues
      - file:line — [specific issue]

      ## Required Changes
      - [what needs to change]
      </event>
      ```

      ### DON'T
      - ❌ Make code changes yourself
      - ❌ Be vague about what's wrong
      - ❌ Block on style nitpicks